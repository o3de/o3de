/*
 * Copyright (c) Contributors to the Open 3D Engine Project.
 * For complete copyright and license terms please see the LICENSE at the root of this distribution.
 *
 * SPDX-License-Identifier: Apache-2.0 OR MIT
 *
 */

#ifndef AZ_COLLECTING_PARTIAL_SRGS
#error Do not include this file directly. Include the main .srgi file instead.
#endif

#include <Atom/Feature/Common/Assets/ShaderResourceGroups/SkyBox/SceneSrg.azsli>
#include <Atom/Feature/Common/Assets/ShaderResourceGroups/CoreLights/SceneSrg.azsli>
#include <Atom/Feature/Common/Assets/ShaderResourceGroups/PostProcessing/SceneSrg.azsli>

partial ShaderResourceGroup SceneSrg
{

    struct ObjectToWorld
    {
        row_major float3x4 m_transform;
    };
    
    struct NormalToWorld
    {
        row_major float3x4 m_transform;
    };

    StructuredBuffer<ObjectToWorld> m_objectToWorldBuffer;
    StructuredBuffer<NormalToWorld> m_objectToWorldInverseTransposeBuffer;
    StructuredBuffer<ObjectToWorld> m_objectToWorldHistoryBuffer;
    
    TextureCube m_specularEnvMap;
    TextureCube m_diffuseEnvMap;
    float4 m_iblOrientation;
    float m_iblExposure;
    
    // --- Debugging ---

    bool m_debuggingEnabled;

    // Material debug overrides...
    float3 m_debugOverrideBaseColor;
    float m_debugOverrideRoughness;
    float m_debugOverrideMetallic;

    // Specifies a lighting direction and intensity for debug purposes 
    float3 m_debugLightingDirection;
    float3 m_debugLightingIntensity;

    float m_customDebugFloat01;
    float m_customDebugFloat02;
    float m_customDebugFloat03;
    float m_customDebugFloat04;

    // --- Samplers ---

    Sampler m_samplerEnv
    {
        AddressU = Wrap;
        AddressV = Wrap;
        MinFilter = Linear;
        MagFilter = Linear;
        MipFilter = Linear;
    };
    
    // --- Functions ---

    float4x4 GetObjectToWorldMatrix(uint objectId)
    {
        return float4x4(
            m_objectToWorldBuffer[objectId].m_transform[0],
            m_objectToWorldBuffer[objectId].m_transform[1],
            m_objectToWorldBuffer[objectId].m_transform[2],
            float4(0, 0, 0, 1));
    }
    
    // Used for transforming normals, handles non-uniform scale correctly.
    float3x3 GetObjectToWorldInverseTransposeMatrix(uint objectId)
    {
        return float3x3(
            m_objectToWorldInverseTransposeBuffer[objectId].m_transform[0].xyz,
            m_objectToWorldInverseTransposeBuffer[objectId].m_transform[1].xyz,
            m_objectToWorldInverseTransposeBuffer[objectId].m_transform[2].xyz
        );
    }
    
    float4x4 GetObjectToWorldMatrixPrev(uint objectId)
    {
        return float4x4(
            m_objectToWorldHistoryBuffer[objectId].m_transform[0],
            m_objectToWorldHistoryBuffer[objectId].m_transform[1],
            m_objectToWorldHistoryBuffer[objectId].m_transform[2],
            float4(0, 0, 0, 1));
    }
}


