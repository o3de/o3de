/*
 * Copyright (c) Contributors to the Open 3D Engine Project.
 * For complete copyright and license terms please see the LICENSE at the root of this distribution.
 *
 * SPDX-License-Identifier: Apache-2.0 OR MIT
 *
 */

#pragma once

// This file provides exentions to Ibl.azsli that are specific to deferred render pipelines.

#include <Atom/Features/PBR/Lights/Ibl.azsli>

void ApplyIbl_DeferredPass(Surface surface, inout LightingData lightingData)
{
#if FORCE_IBL_IN_FORWARD_PASS
    bool useDiffuseIbl = true;
    bool useSpecularIbl = true;
#else
    #if FORCE_OPAQUE
        bool isTransparent = false;
    #else
        bool isTransparent = (o_opacity_mode == OpacityMode::Blended || o_opacity_mode == OpacityMode::TintedTransparent);
    #endif
    bool useDiffuseIbl = isTransparent;
    bool useSpecularIbl = (isTransparent || o_meshUseForwardPassIBLSpecular || o_materialUseForwardPassIBLSpecular);
#endif

    // Apply Image Based Lighting (IBL)
    // TODO(Deferred): Reflection Probes are not supported currently
    ReflectionProbeData unusedReflectionProbe; 
    TextureCube unusedReflectionProbeCubeMap;
    ApplyIBL(surface, lightingData, true, false, unusedReflectionProbe, unusedReflectionProbeCubeMap);
}
