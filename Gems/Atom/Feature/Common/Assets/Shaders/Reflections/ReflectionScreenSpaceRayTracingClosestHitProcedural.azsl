/*
 * Copyright (c) Contributors to the Open 3D Engine Project.
 * For complete copyright and license terms please see the LICENSE at the root of this distribution.
 *
 * SPDX-License-Identifier: Apache-2.0 OR MIT
 *
 */

#include "ReflectionScreenSpaceRayTracingClosestHit.azsli"
#include <Atom/Features/RayTracing/RayTracingIntersectionAttributes.azsli>

// TODO(intersection): Implement multiple closesthit-shaders per source file
[shader("closesthit")]
void ClosestHitProcedural(inout PayloadData payload, ProceduralGeometryIntersectionAttributes attrib)
{
    VsInput vertexData;
    vertexData.position = attrib.GetPosition();
    vertexData.normal = attrib.GetNormal();
    vertexData.uv0 = attrib.GetUv();
    vertexData.tangent = attrib.GetTangent();
    vertexData.bitangent = cross(vertexData.normal, vertexData.tangent.xyz) * vertexData.tangent.w;

    ScreenSpaceClosestHitImpl(payload, vertexData, transpose(ObjectToWorld4x3()));
}
